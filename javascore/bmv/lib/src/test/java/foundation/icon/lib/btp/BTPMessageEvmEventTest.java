package foundation.icon.lib.btp;

import java.math.BigInteger;

import foundation.icon.btp.lib.event.evmEvent.BTPMessageEvmEvent;
import foundation.icon.btp.lib.utils.HexConverter;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;
import org.junit.jupiter.api.TestMethodOrder;

import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

@TestMethodOrder(OrderAnnotation.class)
class BTPMEssageEvmEventTest {
    @Test
    @Order(1)
    public void decodeBTPMessageEVMEvent() {
        String btpMessageEventEncoded = "0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000396274703a2f2f3078332e69636f6e2f637863303130666535353934626333353131653231366136623236323565373134343161306338346362000000000000000000000000000000000000000000000000000000000000000000000000000100f8feb83a6274703a2f2f30783530312e7072612f307830444431414134323966424138333845423034316166623961383844386446306434316137313830b8396274703a2f2f3078332e69636f6e2f63786330313066653535393462633335313165323136613662323632356537313434316130633834636283626d6300b880f87e844c696e6bf877b83a6274703a2f2f30783530312e7072612f307830444431414134323966424138333845423034316166623961383844386446306434316137313830b8396274703a2f2f3078332e69636f6e2f637863303130666535353934626333353131653231366136623236323565373134343161306338346362";
        BTPMessageEvmEvent btpMessageEvmEvent = new BTPMessageEvmEvent(HexConverter.hexStringToByteArray(btpMessageEventEncoded));

        assertTrue(btpMessageEvmEvent.getNextBmc().equals("btp://0x3.icon/cxc010fe5594bc3511e216a6b2625e71441a0c84cb"));
        assertTrue(btpMessageEvmEvent.getSeq().equals(BigInteger.valueOf(1)));
        assertArrayEquals(btpMessageEvmEvent.getMsg(), HexConverter.hexStringToByteArray("f8feb83a6274703a2f2f30783530312e7072612f307830444431414134323966424138333845423034316166623961383844386446306434316137313830b8396274703a2f2f3078332e69636f6e2f63786330313066653535393462633335313165323136613662323632356537313434316130633834636283626d6300b880f87e844c696e6bf877b83a6274703a2f2f30783530312e7072612f307830444431414134323966424138333845423034316166623961383844386446306434316137313830b8396274703a2f2f3078332e69636f6e2f637863303130666535353934626333353131653231366136623236323565373134343161306338346362"));
    }
}